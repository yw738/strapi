import{r as G,ck as O,q as Y,u as k,a as q,c7 as H,dz as Q,dA as J,j as t,d as r,co as K,dB as U,bI as _,dC as W,dD as d,cb as f,bK as x,dE as X,dF as Z,dG as v,cY as $,c as tt,dH as st,dI as et,o as at,dJ as it}from"./strapi-y0akA7lV.js";import{u as nt,F as C}from"./Input-r7RCMVRQ.js";import"./usePrev-B71R5_47.js";import"./objects-DL4QYPH-.js";import"./getEmptyImage-CjqolaH3.js";import"./ComponentIcon-BCASJu6q.js";const ot=s=>G.useEffect(s,rt),rt=[],dt=()=>{const s=O(),[{query:{status:a}},i]=Y({status:"draft"}),{formatMessage:n}=k(),{toggleNotification:o}=q(),c=H(),{document:b,meta:u,isLoading:I,schema:l,components:j,collectionType:y,id:L,model:S,hasError:A,getTitle:P,getInitialFormValues:R}=c,m=l?.options?.draftAndPublish??!1;ot(()=>{s?.state&&"error"in s.state&&o({type:"danger",message:s.state.error,timeout:5e3})});const F=Q("EditViewPage",e=>e.isLoading),g=!L&&!(y===it),{isLoading:V,edit:{layout:E,settings:{mainField:T}}}=J(S),{isLazyLoading:B}=nt([]),M=F||I||V||B,h=R(g);if(M&&!b?.documentId)return t.jsx(r.Loading,{});if(!h||A)return t.jsx(r.Error,{});const N=e=>{(e==="published"||e==="draft")&&i({status:e},"push",!0)},w=(e,p)=>v(l?.attributes,j,{status:a,...p}).validateSync(e,{abortEarly:!1});return t.jsxs(K,{paddingLeft:10,paddingRight:10,children:[t.jsx(r.Title,{children:P(T)}),t.jsx(U,{initialDocument:{documentId:L,model:S,collectionType:y},children:t.jsx(_,{disabled:m&&a==="published",initialValues:h,method:g?"POST":"PUT",validate:(e,p)=>v(l?.attributes,j,{status:a,...p}).validate(e,{abortEarly:!1}),initialErrors:s?.state?.forceValidation?w(h,{}):{},children:({resetForm:e})=>t.jsxs(t.Fragment,{children:[t.jsx(W,{isCreating:g,status:m?ct(b,u):void 0,title:P(T)}),t.jsxs(d.Root,{variant:"simple",value:a,onValueChange:N,children:[t.jsx(d.List,{"aria-label":n({id:f("containers.edit.tabs.label"),defaultMessage:"Document status"}),children:m?t.jsxs(t.Fragment,{children:[t.jsx(D,{value:"draft",children:n({id:f("containers.edit.tabs.draft"),defaultMessage:"draft"})}),t.jsx(D,{disabled:!u||u.availableStatus.length===0,value:"published",children:n({id:f("containers.edit.tabs.published"),defaultMessage:"published"})})]}):null}),t.jsxs(x.Root,{paddingTop:8,gap:4,children:[t.jsxs(x.Item,{col:9,s:12,direction:"column",alignItems:"stretch",children:[t.jsx(d.Content,{value:"draft",children:t.jsx(C,{layout:E,document:c})}),t.jsx(d.Content,{value:"published",children:t.jsx(C,{layout:E,document:c})})]}),t.jsx(x.Item,{col:3,s:12,direction:"column",alignItems:"stretch",children:t.jsx(X,{})})]})]}),t.jsx(Z,{onProceed:e})]})})})]})},D=at(d.Trigger)`
  text-transform: uppercase;
`,ct=(s,a)=>{const i=s?.status,n=a?.availableStatus??[];return i?i==="draft"&&n.find(o=>o.publishedAt!==null)?"published":i:"draft"},xt=()=>{const{slug:s=""}=$(),{permissions:a=[],isLoading:i,error:n}=tt(st.map(o=>({action:o,subject:s})));return i?t.jsx(r.Loading,{}):n||!s?t.jsx(r.Error,{}):t.jsx(r.Protect,{permissions:a,children:({permissions:o})=>t.jsx(et,{permissions:o,children:t.jsx(dt,{})})})};export{dt as EditViewPage,xt as ProtectedEditViewPage,ct as getDocumentStatus};
